// var data = [{"name":"System/CPU/IO Wait/percent","data":[{"time":"2015-07-22T22:31:00+00:00","value":0.085},{"time":"2015-07-22T22:32:00+00:00","value":0.0435},{"time":"2015-07-22T22:33:00+00:00","value":0.129},{"time":"2015-07-22T22:34:00+00:00","value":0.114},{"time":"2015-07-22T22:35:00+00:00","value":0.128},{"time":"2015-07-22T22:36:00+00:00","value":0.0579},{"time":"2015-07-22T22:37:00+00:00","value":0.0581},{"time":"2015-07-22T22:38:00+00:00","value":0.0821},{"time":"2015-07-22T22:39:00+00:00","value":0.0516},{"time":"2015-07-22T22:40:00+00:00","value":0.145},{"time":"2015-07-22T22:41:00+00:00","value":0.102},{"time":"2015-07-22T22:42:00+00:00","value":0.0604},{"time":"2015-07-22T22:43:00+00:00","value":0.139},{"time":"2015-07-22T22:44:00+00:00","value":0.144},{"time":"2015-07-22T22:45:00+00:00","value":0.122},{"time":"2015-07-22T22:46:00+00:00","value":0.172},{"time":"2015-07-22T22:47:00+00:00","value":0.314},{"time":"2015-07-22T22:48:00+00:00","value":0.0675},{"time":"2015-07-22T22:49:00+00:00","value":0.121},{"time":"2015-07-22T22:50:00+00:00","value":0.0775},{"time":"2015-07-22T22:51:00+00:00","value":0.0987},{"time":"2015-07-22T22:52:00+00:00","value":0.106},{"time":"2015-07-22T22:53:00+00:00","value":0.106},{"time":"2015-07-22T22:54:00+00:00","value":0.0884},{"time":"2015-07-22T22:55:00+00:00","value":0.543},{"time":"2015-07-22T22:56:00+00:00","value":0.131},{"time":"2015-07-22T22:57:00+00:00","value":0.0727},{"time":"2015-07-22T22:58:00+00:00","value":0.154},{"time":"2015-07-22T22:59:00+00:00","value":0.087},{"time":"2015-07-22T23:00:00+00:00","value":0.0833},{"time":"2015-07-22T23:01:00+00:00","value":0.174},{"time":"2015-07-22T23:02:00+00:00","value":0.0723},{"time":"2015-07-22T23:03:00+00:00","value":0.0508},{"time":"2015-07-22T23:04:00+00:00","value":0.0618},{"time":"2015-07-22T23:05:00+00:00","value":0.0585},{"time":"2015-07-22T23:06:00+00:00","value":0.0464},{"time":"2015-07-22T23:07:00+00:00","value":0.0577},{"time":"2015-07-22T23:08:00+00:00","value":0.308},{"time":"2015-07-22T23:09:00+00:00","value":0.159},{"time":"2015-07-22T23:10:00+00:00","value":0.102},{"time":"2015-07-22T23:11:00+00:00","value":0.0841},{"time":"2015-07-22T23:12:00+00:00","value":0.0833},{"time":"2015-07-22T23:13:00+00:00","value":0.0675},{"time":"2015-07-22T23:14:00+00:00","value":0.031},{"time":"2015-07-22T23:15:00+00:00","value":0.0589},{"time":"2015-07-22T23:16:00+00:00","value":0.0604},{"time":"2015-07-22T23:17:00+00:00","value":0.098},{"time":"2015-07-22T23:18:00+00:00","value":0.0485},{"time":"2015-07-22T23:19:00+00:00","value":0.0696},{"time":"2015-07-22T23:20:00+00:00","value":0.0669},{"time":"2015-07-22T23:21:00+00:00","value":0.039},{"time":"2015-07-22T23:22:00+00:00","value":0.117},{"time":"2015-07-22T23:23:00+00:00","value":0.0654},{"time":"2015-07-22T23:24:00+00:00","value":0.0546},{"time":"2015-07-22T23:25:00+00:00","value":0.252},{"time":"2015-07-22T23:26:00+00:00","value":0.0764},{"time":"2015-07-22T23:27:00+00:00","value":0.3},{"time":"2015-07-22T23:28:00+00:00","value":0.073},{"time":"2015-07-22T23:29:00+00:00","value":0.0604},{"time":"2015-07-22T23:30:00+00:00","value":0.149}]},{"name":"System/CPU/System/percent","data":[{"time":"2015-07-22T22:31:00+00:00","value":2.07},{"time":"2015-07-22T22:32:00+00:00","value":1.88},{"time":"2015-07-22T22:33:00+00:00","value":2},{"time":"2015-07-22T22:34:00+00:00","value":2.21},{"time":"2015-07-22T22:35:00+00:00","value":2.1},{"time":"2015-07-22T22:36:00+00:00","value":2.07},{"time":"2015-07-22T22:37:00+00:00","value":2.12},{"time":"2015-07-22T22:38:00+00:00","value":2.2},{"time":"2015-07-22T22:39:00+00:00","value":2.15},{"time":"2015-07-22T22:40:00+00:00","value":1.96},{"time":"2015-07-22T22:41:00+00:00","value":2.18},{"time":"2015-07-22T22:42:00+00:00","value":2.01},{"time":"2015-07-22T22:43:00+00:00","value":2.11},{"time":"2015-07-22T22:44:00+00:00","value":2.12},{"time":"2015-07-22T22:45:00+00:00","value":2.2},{"time":"2015-07-22T22:46:00+00:00","value":2.52},{"time":"2015-07-22T22:47:00+00:00","value":2.31},{"time":"2015-07-22T22:48:00+00:00","value":1.8},{"time":"2015-07-22T22:49:00+00:00","value":1.95},{"time":"2015-07-22T22:50:00+00:00","value":2.07},{"time":"2015-07-22T22:51:00+00:00","value":1.82},{"time":"2015-07-22T22:52:00+00:00","value":2.4},{"time":"2015-07-22T22:53:00+00:00","value":2.43},{"time":"2015-07-22T22:54:00+00:00","value":2.89},{"time":"2015-07-22T22:55:00+00:00","value":2.71},{"time":"2015-07-22T22:56:00+00:00","value":2.11},{"time":"2015-07-22T22:57:00+00:00","value":1.91},{"time":"2015-07-22T22:58:00+00:00","value":2.29},{"time":"2015-07-22T22:59:00+00:00","value":1.88},{"time":"2015-07-22T23:00:00+00:00","value":2.2},{"time":"2015-07-22T23:01:00+00:00","value":2.25},{"time":"2015-07-22T23:02:00+00:00","value":2.14},{"time":"2015-07-22T23:03:00+00:00","value":1.62},{"time":"2015-07-22T23:04:00+00:00","value":2.59},{"time":"2015-07-22T23:05:00+00:00","value":2.91},{"time":"2015-07-22T23:06:00+00:00","value":3.45},{"time":"2015-07-22T23:07:00+00:00","value":3.44},{"time":"2015-07-22T23:08:00+00:00","value":3.72},{"time":"2015-07-22T23:09:00+00:00","value":3.53},{"time":"2015-07-22T23:10:00+00:00","value":3.73},{"time":"2015-07-22T23:11:00+00:00","value":3.52},{"time":"2015-07-22T23:12:00+00:00","value":3.51},{"time":"2015-07-22T23:13:00+00:00","value":3.43},{"time":"2015-07-22T23:14:00+00:00","value":3.39},{"time":"2015-07-22T23:15:00+00:00","value":3.88},{"time":"2015-07-22T23:16:00+00:00","value":3.91},{"time":"2015-07-22T23:17:00+00:00","value":3.6},{"time":"2015-07-22T23:18:00+00:00","value":3.58},{"time":"2015-07-22T23:19:00+00:00","value":3.73},{"time":"2015-07-22T23:20:00+00:00","value":3.98},{"time":"2015-07-22T23:21:00+00:00","value":3.49},{"time":"2015-07-22T23:22:00+00:00","value":3.29},{"time":"2015-07-22T23:23:00+00:00","value":3.51},{"time":"2015-07-22T23:24:00+00:00","value":2.43},{"time":"2015-07-22T23:25:00+00:00","value":1.91},{"time":"2015-07-22T23:26:00+00:00","value":1.9},{"time":"2015-07-22T23:27:00+00:00","value":1.97},{"time":"2015-07-22T23:28:00+00:00","value":1.9},{"time":"2015-07-22T23:29:00+00:00","value":1.89},{"time":"2015-07-22T23:30:00+00:00","value":1.88}]},{"name":"System/CPU/User/percent","data":[{"time":"2015-07-22T22:31:00+00:00","value":6.9},{"time":"2015-07-22T22:32:00+00:00","value":5.08},{"time":"2015-07-22T22:33:00+00:00","value":7.27},{"time":"2015-07-22T22:34:00+00:00","value":8.46},{"time":"2015-07-22T22:35:00+00:00","value":6.96},{"time":"2015-07-22T22:36:00+00:00","value":5.2},{"time":"2015-07-22T22:37:00+00:00","value":7.02},{"time":"2015-07-22T22:38:00+00:00","value":11.6},{"time":"2015-07-22T22:39:00+00:00","value":7.86},{"time":"2015-07-22T22:40:00+00:00","value":7.02},{"time":"2015-07-22T22:41:00+00:00","value":7.6},{"time":"2015-07-22T22:42:00+00:00","value":6.49},{"time":"2015-07-22T22:43:00+00:00","value":6.87},{"time":"2015-07-22T22:44:00+00:00","value":6.9},{"time":"2015-07-22T22:45:00+00:00","value":8.02},{"time":"2015-07-22T22:46:00+00:00","value":9.3},{"time":"2015-07-22T22:47:00+00:00","value":9.33},{"time":"2015-07-22T22:48:00+00:00","value":5.66},{"time":"2015-07-22T22:49:00+00:00","value":5.72},{"time":"2015-07-22T22:50:00+00:00","value":6.64},{"time":"2015-07-22T22:51:00+00:00","value":5.55},{"time":"2015-07-22T22:52:00+00:00","value":9.94},{"time":"2015-07-22T22:53:00+00:00","value":10.2},{"time":"2015-07-22T22:54:00+00:00","value":12.6},{"time":"2015-07-22T22:55:00+00:00","value":10.4},{"time":"2015-07-22T22:56:00+00:00","value":6.62},{"time":"2015-07-22T22:57:00+00:00","value":5.64},{"time":"2015-07-22T22:58:00+00:00","value":8.25},{"time":"2015-07-22T22:59:00+00:00","value":6.27},{"time":"2015-07-22T23:00:00+00:00","value":7.24},{"time":"2015-07-22T23:01:00+00:00","value":10.6},{"time":"2015-07-22T23:02:00+00:00","value":8.64},{"time":"2015-07-22T23:03:00+00:00","value":4.24},{"time":"2015-07-22T23:04:00+00:00","value":12.9},{"time":"2015-07-22T23:05:00+00:00","value":11.7},{"time":"2015-07-22T23:06:00+00:00","value":16.5},{"time":"2015-07-22T23:07:00+00:00","value":16.9},{"time":"2015-07-22T23:08:00+00:00","value":17.9},{"time":"2015-07-22T23:09:00+00:00","value":17.5},{"time":"2015-07-22T23:10:00+00:00","value":17.9},{"time":"2015-07-22T23:11:00+00:00","value":16.1},{"time":"2015-07-22T23:12:00+00:00","value":16},{"time":"2015-07-22T23:13:00+00:00","value":17},{"time":"2015-07-22T23:14:00+00:00","value":15.8},{"time":"2015-07-22T23:15:00+00:00","value":19.7},{"time":"2015-07-22T23:16:00+00:00","value":19.9},{"time":"2015-07-22T23:17:00+00:00","value":20.4},{"time":"2015-07-22T23:18:00+00:00","value":16},{"time":"2015-07-22T23:19:00+00:00","value":17.4},{"time":"2015-07-22T23:20:00+00:00","value":18.4},{"time":"2015-07-22T23:21:00+00:00","value":16.4},{"time":"2015-07-22T23:22:00+00:00","value":15.5},{"time":"2015-07-22T23:23:00+00:00","value":17.2},{"time":"2015-07-22T23:24:00+00:00","value":9.33},{"time":"2015-07-22T23:25:00+00:00","value":5.1},{"time":"2015-07-22T23:26:00+00:00","value":5.99},{"time":"2015-07-22T23:27:00+00:00","value":6.38},{"time":"2015-07-22T23:28:00+00:00","value":6.36},{"time":"2015-07-22T23:29:00+00:00","value":6.36},{"time":"2015-07-22T23:30:00+00:00","value":5.53}]}];

let data = [27, 4, 11, 6, 28, 13 ,8, 12, 30];

function lineChart() {
  var width = 0,
      height = 0,
      margin = {
        top: 20,
        right: 40,
        bottom: 20,
        left: 40
      };

  function chart(selector) {
    selector.each(function(data) {
      let chartWidth = width - margin.left - margin.right,
          chartHeight = height - margin.top - margin.bottom;

      let xScale = d3.scale.linear()
        .range([0, chartWidth])
        .domain([1, data.length]);

      let yScale = d3.scale.linear()
        .range([0, chartHeight])
        .domain([ d3.max(data), 0]);

      let yAxis = d3.svg.axis()
        .scale(yScale)
        .tickValues([0, 15, 30]);

      let yAxisGrid = d3.svg.axis()
        .scale(yScale)
       .tickValues([0, 15, 30])
        .tickSize(chartWidth, 0)
        .tickFormat('')
        .orient('right');

      let line = d3.svg.line()
        .x((d, i) => xScale(i + 1))
        .y(d => yScale(d))
        .interpolate('monotone');

      let area = d3.svg.area()
        .x((d, i) => xScale(i + 1))
        .y(d => yScale(d))
        .y0(chartHeight)
        .interpolate('monotone');

      let svg = d3.select(this).data([data]),
          g = svg.append('svg').append('g');

      svg
        .attr('width', width)
        .attr('height', height);

      g
        .attr('transform', `translate(${margin.left}, ${margin.top})`);

      g.append('g')
        .attr('class', 'grid')
        .call(yAxisGrid);

      g.append('path')
        .attr('class', 'area')
        .attr('d', area);

      g.append('path')
        .attr('class', 'line')
        .attr('d', line);

      g.append('g')
        .attr('class', 'points')
        .selectAll('circle')
        .data(data)
      .enter().append('circle')
        .attr('class', 'point')
        .attr('cx', (d, i) => xScale(i + 1))
        .attr('cy', d => yScale(d))
        .attr('r', 5);

      g.append('g')
        .attr('class', 'axis')
        .call(yAxis.orient('left').tickPadding(10));
    });
  }

  let methods = {
    width: function(v) {
      if (!arguments.length) return width;
      width = v;
      return chart;
    },
    height: function(v) {
      if (!arguments.length) return height;
      height = v;
      return chart;
    }
  };

  for (let key in methods) {
    chart[key] = methods[key];
  }

  return chart;
};

let generateChart = lineChart()
  .width(500)
  .height(200);

d3.select('.chart')
  .datum(data)
  .call(generateChart);